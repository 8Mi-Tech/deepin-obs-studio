name: CI Test Build
on: workflow_dispatch
jobs:
  deepin-beige:
    runs-on: ubuntu-latest
    container:
      image: linuxdeepin/beige:base
    steps:
      - uses: actions/checkout@v3
        name: Checkout Git Repository
        with:
          submodules: true
          repository: "obsproject/obs-studio"
          ref: "refs/tags/29.0.2"
      - name: Prepare APT Depend
        shell: bash
        run: |
          echo "首行不给看,要看指令的自己点展开" >> /dev/null
          echo "::group::APT Detect"
          apt update
          echo "::group::Build system dependencies"
          apt install -y cmake ninja-build pkg-config clang clang-format build-essential curl ccache git
          echo "::group::OBS dependencies（core）"
          apt install -y libavcodec-dev libavdevice-dev libavfilter-dev libavformat-dev libavutil-dev libswresample-dev libswscale-dev libx264-dev libcurl4-openssl-dev libmbedtls-dev libgl1-mesa-dev libjansson-dev libluajit-5.1-dev python3-dev libx11-dev libxcb-randr0-dev libxcb-shm0-dev libxcb-xinerama0-dev libxcb-composite0-dev libxcomposite-dev libxinerama-dev libxcb1-dev libx11-xcb-dev libxcb-xfixes0-dev swig libcmocka-dev libxss-dev libglvnd-dev libgles2-mesa libgles2-mesa-dev libwayland-dev librist-dev libsrt-openssl-dev libpci-dev
          echo "::group::OBS dependencies（Qt6 UI）"
          apt install -y qt6-base-dev qt6-base-private-dev libqt6svg6-dev qt6-wayland qt6-image-formats-plugins
          echo "::group::Plugin dependencies"
          apt install -y libasound2-dev libfdk-aac-dev libfontconfig-dev libfreetype6-dev libjack-jackd2-dev libpulse-dev libsndio-dev libspeexdsp-dev libudev-dev libv4l-dev libva-dev libvlc-dev libdrm-dev
      - name: Build OBS Studio
        shell: bash
        # working-directory: src
        run: |
          echo "首行不给看,要看指令的自己点展开" >> /dev/null
          echo "::group::OneKey Build OBS Studio"
          chmod +x CI/build-linux.sh
          CI/build-linux.sh --verbose --skip-dependency-checks --package --build-dir "/opt/apps/com.obsproject.studio"
